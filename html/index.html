<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°éƒä¸­åŸ¹å…»æ—¥è®°</title>

</head>
<body>
    <!-- ä¾§è¾¹æ å¯¼èˆª -->
    <nav class="sidebar">
        <div class="sidebar-title">
            <h1>å°å°å¤§å¤«</h1>
        </div>
        <ul class="nav-links">
            <li><a data-page="home" class="active">ä¸»é¡µ</a></li>
            <li><a data-page="learn">å°éƒä¸­å­¦è¯æ</a></li>
            <li><a data-page="master">å°éƒä¸­æ‹œå¤§å¸ˆ</a></li>
            <li><a data-page="practice">å°éƒä¸­ç»ƒå°æ‰‹</a></li>
            <li><a data-page="identify">å°éƒä¸­è®¤æ¤ç‰©</a></li>
        </ul>
        <div class="text-box">
            <h4 class="emoji-text">à¸…^â€¢ï»Œâ€¢^à¸…</h4>
            <h4>è¿™é‡Œå°†èµ°ä¸Šæ¡æˆä¸ºå°å¤§å¤«çš„"å½“å½’è·¯"</h4>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content">
        <!-- ä¸»é¡µ -->
        <section id="home" class="page-section active">
            <style>
                #home {
                    text-align: center;
                    justify-content: center; /* å‚ç›´å±…ä¸­ */
                }
                #home .card {
                    background: #ebe4dc;
                    border-radius: 8px;
                    padding: 20px;
                    margin-bottom: 20px;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                }

                #home .herb-image {
                    width: 100%; /* è®¾ç½®å›¾ç‰‡å®½åº¦ä¸ºå®¹å™¨å®½åº¦çš„100% */
                    height: auto; /* é«˜åº¦è‡ªåŠ¨è°ƒæ•´ä»¥ä¿æŒæ¯”ä¾‹ */
                    object-fit: cover; /* å›¾ç‰‡è¦†ç›–æ•´ä¸ªå®¹å™¨ï¼Œä½†ä¿æŒæ¯”ä¾‹ */
                    border-radius: 4px;
                }
                #home .card:hover {
                    transform: translateY(-5px); /* å‘ä¸Šç§»åŠ¨5px */
                    box-shadow: 0 4px 8px rgba(0,0,0,0.2); /* æ·»åŠ é˜´å½±æ•ˆæœ */
                    transition: transform 0.3s, box-shadow 0.3s; /* è¿‡æ¸¡æ•ˆæœçš„æ—¶é—´ */
                }
            </style>
                  <h1>æ¬¢è¿æ¥åˆ°æ¬¢ä¹å°è¯å ‚</h1>
                <p class="caption">ğŸŒ¿ ä½ å°†ä»è¿™é‡Œå¼€å§‹ä½ çš„å°å°éƒä¸­ä¹‹æ—…ã€‚</p>
                <img src="/static/images/herbs/xiao.png" alt="Welcome Image" class="herb-image" style="width:50%; height: auto;">
            </div>
            </style>
                <h2>ä¸­åŒ»è¯</h2>
                <p>ä¸­åŒ»ï¼Œä¸­åæ°‘æ—ç‘°å®ã€‚ä»¥é˜´é˜³äº”è¡Œç­‰ç†è®ºä¸ºåŸºç¡€ï¼Œé€šè¿‡æœ›é—»é—®åˆ‡è¯Šæ–­ç—…æƒ…ã€‚é‡‡ç”¨ä¸­è¯ã€é’ˆç¸ã€æ¨æ‹¿ç­‰ç–—æ³•ï¼Œæ³¨é‡æ•´ä½“è§‚å¿µä¸è¾¨è¯è®ºæ²»ã€‚å†ç»åƒå¹´ä¼ æ‰¿ï¼Œåœ¨æ²»ç–—ç–¾ç—…ã€å…»ç”Ÿä¿å¥æ–¹é¢å‘æŒ¥ç€ç‹¬ç‰¹ä½œç”¨ï¼Œä¸ºäººç±»å¥åº·ä½œå‡ºå“è¶Šè´¡çŒ®ã€‚</p>
            </div>
            
        </section>

        <!-- å­¦è¯æéƒ¨åˆ† -->
        <section id="learn" class="page-section">
            <style>
                #learn .herbs-section {
                    padding: 20px;
                    background: #ebe4dc;
                    border-radius: 8px;
                    margin: 20px 0;
                }

                #learn .herb-card {
                    border: 1px solid #ebe4dc;
                    border-radius: 8px;
                    padding: 15px;
                    margin: 10px 0;
                    background: #ebe4dc;
                }

                #learn .herb-image {
                    max-width: 100%;
                    height: auto;
                    border-radius: 4px;
                    margin: 10px 0;
                }

                #learn .game-section {
                    margin-top: 20px;
                    padding: 20px;
                    background: #ebe4dc;
                    border-radius: 8px;
                }

                #learn .button {
                    background-color: var(--primary-color);
                    color: #ebe4dc;
                    border: none;
                    padding: 10px 20px;
                    border-radius: 4px;
                    cursor: pointer;
                    margin: 10px 0;
                }

                #learn .button:hover {
                    background-color: var(--secondary-color);
                }
            </style>

            <div class="herbs-section">
                <h1>å°éƒä¸­å­¦è¯æ: ç†Ÿæ‚‰è¯æ</h1>
                <p>ç†Ÿæ‚‰è¯è‰æ˜¯ä¸€ä¸ªéƒä¸­çš„å¿…ä¿®è¯¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆè§è¯†ä¸€äº›å¸¸è§çš„è‰è¯å§ï¼ğŸ˜</p>
                
                <div class="herb-selection">
                    <h2>é€‰æ‹©ä¸€ç§è¯æäº†è§£æ›´å¤š</h2>
                    <select class="herb-select" id="herbSelect">
                        <option value="">è¯·é€‰æ‹©è¯æ...</option>
                        <option value="äººå‚">äººå‚</option>
                        <option value="é»„èŠª">é»„èŠª</option>
                        <option value="å½“å½’">å½“å½’</option>
                        <option value="å…šå‚">å…šå‚</option>
                        <option value="åŠå¤">åŠå¤</option>
                        <option value="é±¼èƒ†è‰">é±¼èƒ†è‰</option>
                        <option value="è·¯è·¯é€š">è·¯è·¯é€š</option>
                        <option value="èƒ†æœ¨">èƒ†æœ¨</option>
                        <option value="å±±å§œ">å±±å§œ</option>
                        <option value="è—¤é»„">è—¤é»„</option>
                        <option value="è‚‰è±†è”»">è‚‰è±†è”»</option>
                        <option value="å±±è¸è‚‰">å±±è¸è‚‰</option>
                        <option value="èè—¦">èè—¦</option>
                        <option value="ä¹Œæ¡•å­">ä¹Œæ¡•å­</option>
                        <option value="ä¸€ç‚¹çº¢">ä¸€ç‚¹çº¢</option>
                        <option value="é†‰é±¼è‰">é†‰é±¼è‰</option>
                        <option value="é“è‹‹">é“è‹‹</option>
                        <option value="å…«è§’è²">å…«è§’è²</option>
                        <option value="æµ·é©¬">æµ·é©¬</option>
                        <option value="ä¹èŠ‚è–è’²">ä¹èŠ‚è–è’²</option>
                        <option value="é˜²é£è‰">é˜²é£è‰</option>
                        <option value="è±†è”»">è±†è”»</option>
                    </select>

                    <div id="herbInfo" class="herb-card" style="display: none;">
                        <h3 id="herbName"></h3>
                        <img id="herbImage" src="" alt="" class="herb-image">
                        <p id="herbDescription"></p>
                    </div>
                </div>

                <div class="game-section">
                    <h2>è¯æçŒœçŒœä¹</h2>
                    <p>è¿™æ˜¯ä¸€ä¸ªé€šè¿‡å›¾ç‰‡çŒœæµ‹è¯æåç§°çš„å°æ¸¸æˆã€‚</p>
                    <button id="startGame" class="button">å¼€å§‹æ¸¸æˆ</button>

                    <div id="gameArea" style="display: none;">
                        <img id="questionImage" src="" alt="çŒœçŒœè¿™æ˜¯ä»€ä¹ˆè¯æï¼Ÿ" class="herb-image">
                        <form class="guess-form">
                            <input type="text" id="userGuess" class="input-field" placeholder="è¯·è¾“å…¥ä½ çš„çŒœæµ‹">
                            <button type="submit" class="button">æäº¤</button>
                        </form>
                        <p id="gameResult"></p>
                        <button id="playAgain" class="button" style="display: none;">å†ç©ä¸€æ¬¡</button>
                    </div>
                </div>
            </div>
        </section>
        <!--æ¤ç‰©è¯†åˆ« -->
        <section id="identify" class="page-section">
            <h1>æ¤ç‰©è¯†åˆ«</h1>
            <form id="uploadForm" enctype="multipart/form-data">
                <label for="imageInput">è¯·ä¸Šä¼ æ‚¨æƒ³è¯†åˆ«çš„å›¾ç‰‡ï¼ˆä¸ºä¿è¯è¯†åˆ«æ•ˆæœï¼Œæ–‡ä»¶å¤§å°è¯·ä¿æŒåœ¨10MBä»¥ä¸‹ï¼›æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼šJPG, JPEG, PNGï¼‰:</label>
                <input type="file" id="imageInput" name="image" accept=".jpg, .jpeg, .png ,.webp ,.bmp" required>
                <button type="button" onclick="uploadImage()">ä¸Šä¼ å›¾ç‰‡</button>    
                <footer class="page-footer">
                <p>è‹¥æƒ³äº†è§£æ›´å¤šï¼Œè¯·åœ¨å·¦ä¾§è¿›è¡Œé€‰æ‹©ï¼Œè¿›å…¥å°éƒä¸­æ‹œå¤§å¸ˆé¡µé¢</p>
            </footer>
            </form>
             <!-- é¡µé¢åº•éƒ¨ä¿¡æ¯ -->
            
            <div id="result">
                <div id="plantImage"></div>
                <div id="plantInfo">
                    <p id="plantName">åç§°ï¼šåŠ è½½ä¸­...</p>
                    <p id="plantConfidence">ç½®ä¿¡åº¦ï¼šåŠ è½½ä¸­...</p>
                    <p id="plantDescription">æè¿°ï¼šåŠ è½½ä¸­...</p>
                </div>
            </div>
            <script>
                function uploadImage() {
                    const imageInput = document.getElementById('imageInput');
                    const file = imageInput.files[0];
                    if (file) {
                        const formData = new FormData();
                        formData.append('image', file);
        
                        fetch('/api/plant_identify', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.error) {
                                alert(data.error);
                            } else {
                                document.getElementById('plantName').textContent = 'åç§°ï¼š' + data.name;
                                document.getElementById('plantConfidence').textContent = 'ç½®ä¿¡åº¦ï¼š' + data.confidence;
                                document.getElementById('plantDescription').textContent = 'æè¿°ï¼š' + (data.description || 'æš‚æ— æè¿°ä¿¡æ¯ã€‚');
                                
                                // æ¸…é™¤ä¹‹å‰å¯èƒ½å­˜åœ¨çš„å›¾ç‰‡
                                const plantImageDiv = document.getElementById('plantImage');
                                plantImageDiv.innerHTML = ''; // æ¸…é™¤ä¹‹å‰çš„å†…å®¹
                                plantImageDiv.innerHTML = `<img src="${URL.createObjectURL(file)}" alt="Plant Image" style="max-width: 100%; height: auto;" />`; // æ·»åŠ æ–°å›¾ç‰‡
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('ä¸Šä¼ å‡ºé”™ï¼š' + error.message);
                        });
                    } else {
                        alert('è¯·å…ˆé€‰æ‹©ä¸€å¼ å›¾ç‰‡ã€‚');
                    }
                }
                
            </script>
            
        </section>
        

        <!-- æ‹œå¸ˆéƒ¨åˆ† -->
        <section id="master" class="page-section">
            <style>
                #master .master-section {
                    padding: 20px;
                    background:#ebe4dc ;
                    border-radius: 8px;
                    margin: 20px 0;
                    max-width: 800px;
                    margin: 0 auto;
                }

                #master .master-image {
                    width: 200px;
                    height: 200px;
                    border-radius: 50%;
                    margin: 20px auto;
                    display: block;
                    object-fit: cover;
                }

                #master .chat-container {
                    border: 1px solid #ebe4dc;
                    border-radius: 8px;
                    padding: 20px;
                    margin: 20px 0;
                    background: #ebe4dc;
                }

                #master .chat-input {
                    display: flex;
                    gap: 10px;
                    margin-top: 20px;
                }

                #master .message {
                    margin: 10px 0;
                    padding: 10px;
                    border-radius: 8px;
                    max-width: 80%;
                }

                #master .user-message {
                    background-color: #ebe4dc;
                    margin-left: auto;
                }

                #master .master-message {
                    background-color: #ebe4dc;
                    margin-right: auto;
                }
            </style>

            <div class="master-section">
                <h1>å°éƒä¸­æ‹œå¸ˆ: ä¸å¸ˆäº¤æµ</h1>
                <p>åœ¨è¿™é‡Œæˆ‘ä»¬å°†ä»å¸ˆäºææ—¶çå–”ï¼Œå¤§æœ‹å‹å°æœ‹å‹å¦‚æœæœ‰ä»€ä¹ˆç–‘æƒ‘æ•¬è¯·è¯¢é—®å–”ï¼Œæè€å…ˆç”Ÿå°†ä¼šç»™äºˆä½ æ»¡æ„çš„ç­”å¤å–”ï¼</p>

                <img src="/static/images/herbs/li_shizhen.png" alt="ææ—¶çåƒ" class="master-image">

                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message master-message">
                            æ¬¢è¿æ¥åˆ°å°éƒä¸­æ‹œå¸ˆç¯èŠ‚ï¼Œæˆ‘æ˜¯ææ—¶çã€‚æœ‰ä»€ä¹ˆæƒ³é—®çš„ï¼Œå°½ç®¡è¯´å§ã€‚
                        </div>
                    </div>

                    <div class="loading" id="loading">
                        <div class="loading-spinner"></div>
                        <p>æ­£åœ¨æŸ¥æ‰¾ã€Šæœ¬è‰çº²ç›®ã€‹ä¸­çš„ç›¸å…³å†…å®¹...</p>
                    </div>

                    <div class="chat-input">
                        <input type="text" id="userInput" placeholder="è¾“å…¥ä½ æƒ³é—®çš„è¯æ..." />
                        <button onclick="sendMessage()">å‘é€</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ç»ƒå°æ‰‹éƒ¨åˆ† -->
        <section id="practice" class="page-section">
            <style>
                #practice .practice-section {
                    padding: 20px;
                    background: #ebe4dc;
                    border-radius: 8px;
                    margin: 20px 0;
                    max-width: 800px;
                    margin: 0 auto;
                }

                #practice .recipe-card {
                    border: 1px solid #ebe4dc;
                    border-radius: 8px;
                    padding: 20px;
                    margin: 20px 0;
                    background: #ebe4dc;
                    transition: transform 0.2s;
                }

                #practice .recipe-card:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                }

                #practice .steps-list li::before {
                    content: "ğŸ‘‰";
                    margin-right: 10px;
                }

                #practice .warning-list li::before {
                    content: "âš ï¸";
                    margin-right: 10px;
                }
            </style>

            <div class="practice-section">
                <h1>å°éƒä¸­ç»ƒå°æ‰‹: è¯é£ŸåŒæº</h1>
                <p>åœ¨è¿™é‡Œæˆ‘ä»¬å°†å­¦ä¹ ä¸€äº›ä¹‹å‰å­¦è¿‡è¯æï¼Œå¹¶å°†å®ç°è¯é£ŸåŒæºï¼ç»™äº²äººä»¬ä¸€ä¸ªæƒŠå–œã€‚</p>

                <h2>è¯é£ŸåŒæºç®€ä»‹</h2>
                <p>è¯é£ŸåŒæºæ˜¯æŒ‡ä¸€äº›é£Ÿææ—¢å¯ä»¥ä½œä¸ºé£Ÿç‰©ï¼Œåˆå…·æœ‰è¯ç”¨ä»·å€¼ã€‚è¿™äº›é£Ÿæåœ¨ä¸­åŒ»ç†è®ºä¸­è¢«å¹¿æ³›åº”ç”¨ã€‚</p>

                <div class="recipe-selection">
                    <h3>é€‰æ‹©ä¸€ä¸ªèœè°±æŸ¥çœ‹è¯¦æƒ…</h3>
                    <select id="recipeSelect" class="recipe-select">
                        <option value="">è¯·é€‰æ‹©èœè°±...</option>
                        <option value="å½“å½’ç‚–é¸¡">å½“å½’ç‚–é¸¡</option>
                        <option value="é»„èŠªç‚–ç¾Šè‚‰">é»„èŠªç‚–ç¾Šè‚‰</option>
                        <option value="æ¸æçº¢æ£èŒ¶">æ¸æçº¢æ£èŒ¶</option>
                        <option value="å±±è¯ç‚’æœ¨è€³">å±±è¯ç‚’æœ¨è€³</option>
                    </select>

                    <div id="recipeDetails" class="recipe-card" style="display: none;">
                        <h3 id="recipeName"></h3>
                        <img id="recipeImage" src="" alt="" class="recipe-image">
                        <div class="recipe-details">
                            <h4>åŠŸæ•ˆ</h4>
                            <p id="recipeEffect"></p>
                            <h4>åˆ¶ä½œæ­¥éª¤</h4>
                            <ul id="recipeSteps" class="steps-list"></ul>
                        </div>
                    </div>
                </div>

                <div class="notice-box">
                    <h3>æ³¨æ„äº‹é¡¹</h3>
                    <ul class="warning-list">
                        <li>äº†è§£é£Ÿæçš„æ€§è´¨å’ŒåŠŸæ•ˆ</li>
                        <li>æ ¹æ®ä¸ªäººä½“è´¨é€‰æ‹©åˆé€‚çš„é£Ÿæ</li>
                        <li>å­•å¦‡å’Œç‰¹æ®Šäººç¾¤åº”åœ¨åŒ»ç”ŸæŒ‡å¯¼ä¸‹ä½¿ç”¨</li>
                        <li>æ³¨æ„é£Ÿæçš„æ–°é²œåº¦å’Œå«ç”Ÿ</li>
                    </ul>
                </div>
            </div>
        </section>
    </main>

    <script>
        // é¡µé¢åˆ‡æ¢é€»è¾‘
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', function() {
                // ç§»é™¤æ‰€æœ‰æ¿€æ´»çŠ¶æ€
                document.querySelectorAll('.nav-links a').forEach(l => 
                    l.classList.remove('active'));
                document.querySelectorAll('.page-section').forEach(section => 
                    section.classList.remove('active'));

                // æ·»åŠ æ–°çš„æ¿€æ´»çŠ¶æ€
                this.classList.add('active');
                const pageId = this.getAttribute('data-page');
                document.getElementById(pageId).classList.add('active');
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨
                window.scrollTo(0, 0);
            });
        });

        // è¯ææ•°æ®
        const herbData = {
            "äººå‚": {
                description: "äººå‚ï¼Œäº”åŠ ç§‘æ¤ç‰©ï¼Œè¢«èª‰ä¸º'ç™¾è‰ä¹‹ç‹'ï¼Œå…·æœ‰å¤§è¡¥å…ƒæ°”ã€å¤è„‰å›ºè„±ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/yc1.bmp"
            },
            "é»„èŠª": {
                description: "é»„èŠªï¼Œè±†ç§‘æ¤ç‰©ï¼Œæœ‰å¢å¼ºå…ç–«åŠ›ã€åˆ©å°¿æ¶ˆè‚¿ç­‰ä½œç”¨ã€‚",
                image: "/static/images/herbs/é»„èŠª.jpg"
            },
            "å½“å½’": {
                description: "å½“å½’ï¼Œä¼å½¢ç§‘æ¤ç‰©ï¼Œç”¨äºè¡¥è¡€æ´»è¡€ã€è°ƒç»æ­¢ç—›ã€‚",
                image: "/static/images/herbs/å½“å½’.jpg"
            },
            "å…šå‚": {
                description: "å…šå‚, äººå‚ç§‘æ¤ç‰©ï¼Œæœ‰è¡¥ä¸­ç›Šæ°”ã€å¥è„¾ç›Šè‚ºç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/å…šå‚.jpg"
            },
            "åŠå¤": {
                description: "åŠå¤, å¤©å—æ˜Ÿç§‘æ¤ç‰©ï¼Œæœ‰ç‡¥æ¹¿åŒ–ç—°ã€é™é€†æ­¢å‘•ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/åŠå¤.jpg"
            },
            "é±¼èƒ†è‰": {
                description: "é±¼èƒ†è‰, é¾™èƒ†ç§‘æ¤ç‰©ï¼Œæœ‰æ¸…çƒ­æ³»ç«ã€è§£æ¯’åˆ©æ¹¿ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/é±¼èƒ†è‰.jpg"
            },
            "è·¯è·¯é€š": {
                description: "è·¯è·¯é€š, é‡‘ç¼•æ¢…ç§‘æ¤ç‰©ï¼Œæœ‰ç¥›é£æ´»ç»œã€åˆ©æ°´é€šç»ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/è·¯è·¯é€š.jpg"
            },
            "èƒ†æœ¨": {
                description: "èƒ†æœ¨, èŒœè‰ç§‘æ¤ç‰©ï¼Œæœ‰æ¸…çƒ­è§£æ¯’ã€æ¶ˆè‚¿æ­¢ç—›ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/èƒ†æœ¨.jpg"
            },
            "å±±å§œ": {
                description: "å±±å§œ, å§œç§‘æ¤ç‰©ï¼Œæœ‰æ¸©ä¸­æ•£å¯’ã€ç¥›é£æ´»è¡€ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/å±±å§œ.jpg"
            },
            "è—¤é»„": {
                description: "è—¤é»„, è—¤é»„ç§‘æ¤ç‰©ï¼Œæœ‰æ¶ˆè‚¿æ’è„“ã€æ•£ç˜€è§£æ¯’ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/è—¤é»„.jpg"
            },
            "è‚‰è±†è”»": {
                description: "è‚‰è±†è”», è‚‰è±†è”»ç§‘æ¤ç‰©ï¼Œæœ‰æ¸©ä¸­è¡Œæ°”ã€æ¶©è‚ æ­¢æ³»ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/è‚‰è±†è”».jpg"
            },
            "å±±è¸è‚‰": {
                description: "å±±è¸è‚‰, å±±èŒ±è¸ç§‘æ¤ç‰©ï¼Œæœ‰è¡¥ç›Šè‚è‚¾ã€æ¶©ç²¾å›ºè„±ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/å±±è¸è‚‰.jpg"
            },
            "èè—¦": {
                description: "èè—¦, èè—¦ç§‘æ¤ç‰©ï¼Œæœ‰è¡¥ç²¾ç›Šæ°”ã€é€šä¹³è§£æ¯’ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/èè—¦.jpg"
            },
            "ä¹Œæ¡•å­": {
                description: "ä¹Œæ¡•å­, å¤§æˆŸç§‘æ¤ç‰©ï¼Œæœ‰æ€è™«ã€åˆ©æ°´é€šä¾¿ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/ä¹Œæ¡•å­.jpg"
            },
            "ä¸€ç‚¹çº¢": {
                description: "ä¸€ç‚¹çº¢, èŠç§‘æ¤ç‰©ï¼Œæœ‰æ¸…çƒ­è§£æ¯’ã€æ¶ˆç‚åˆ©å°¿ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/ä¸€ç‚¹çº¢.jpg"
            },
            "é†‰é±¼è‰": {
                description: "é†‰é±¼è‰, é©¬é’±ç§‘æ¤ç‰©ï¼Œæœ‰æ­¢å’³å®šå–˜ã€æ´»è¡€ç¥›ç˜€ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/é†‰é±¼è‰.jpg"
            },
            "é“è‹‹": {
                description: "é“è‹‹, å¤§æˆŸç§‘æ¤ç‰©ï¼Œæœ‰æ¸…çƒ­åˆ©æ¹¿ã€å‡‰è¡€è§£æ¯’ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/é“è‹‹.jpg"
            },
            "å…«è§’è²": {
                description: "å…«è§’è², å°æª—ç§‘æ¤ç‰©ï¼Œæœ‰åŒ–ç—°æ•£ç»“ã€ç¥›ç˜€æ­¢ç—›ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/å…«è§’è².jpg"
            },
            "æµ·é©¬": {
                description: "æµ·é©¬, æµ·é¾™ç§‘åŠ¨ç‰©ï¼Œæœ‰æ¸©è‚¾å£®é˜³ã€æ•£ç»“æ¶ˆè‚¿ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/æµ·é©¬.jpg"
            },
            "ä¹èŠ‚è–è’²": {
                description: "ä¹èŠ‚è–è’², æ¯›è¨ç§‘æ¤ç‰©ï¼Œæœ‰å¼€çªåŒ–ç—°ã€é†’è„¾å®‰ç¥ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/ä¹èŠ‚è–è’².jpg"
            },
            "é˜²é£è‰": {
                description: "é˜²é£è‰, å”‡å½¢ç§‘æ¤ç‰©ï¼Œæœ‰ç¥›é£é™¤æ¹¿ã€è§£æ¯’æ­¢ç—›ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/é˜²é£è‰.jpg"
            },
            "è±†è”»": {
                description: "è±†è”», å§œç§‘æ¤ç‰©ï¼Œæœ‰åŒ–æ¹¿æ¶ˆç—ã€è¡Œæ°”æ¸©ä¸­ç­‰åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/è±†è”».jpg"
            }
        };
            // å¯ä»¥ç»§ç»­æ·»åŠ æ›´å¤šè¯ææ•°æ®...
        

        // è¯æé€‰æ‹©å¤„ç†
        document.getElementById('herbSelect')?.addEventListener('change', function(e) {
            const selectedHerb = e.target.value;
            const herbInfo = document.getElementById('herbInfo');
            
            if (selectedHerb && herbData[selectedHerb]) {
                const herb = herbData[selectedHerb];
                document.getElementById('herbName').textContent = selectedHerb;
                document.getElementById('herbImage').src = herb.image;
                document.getElementById('herbDescription').textContent = herb.description;
                herbInfo.style.display = 'block';
            } else {
                herbInfo.style.display = 'none';
            }
        });

        // çŒœçŒœä¹æ¸¸æˆåŠŸèƒ½
        let currentHerb = null;
        
        document.getElementById('startGame')?.addEventListener('click', function() {
            startNewGame();
        });

        function startNewGame() {
            const herbs = Object.keys(herbData);
            currentHerb = herbs[Math.floor(Math.random() * herbs.length)];
            document.getElementById('questionImage').src = herbData[currentHerb].image;
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('gameResult').textContent = '';
            document.getElementById('playAgain').style.display = 'none';
            document.getElementById('userGuess').value = '';
        }

        document.querySelector('.guess-form')?.addEventListener('submit', function(e) {
            e.preventDefault();
            const guess = document.getElementById('userGuess').value.trim();
            if (guess === currentHerb) {
                document.getElementById('gameResult').textContent = 'æ­å–œä½ ï¼Œç­”å¯¹äº†ï¼';
            } else {
                document.getElementById('gameResult').textContent = `å¾ˆé—æ†¾ï¼Œç­”é”™äº†ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${currentHerb}`;
            }
            document.getElementById('playAgain').style.display = 'block';
        });

        document.getElementById('playAgain')?.addEventListener('click', startNewGame);

        // æ‹œå¸ˆéƒ¨åˆ†çš„èŠå¤©åŠŸèƒ½
        // APIè°ƒç”¨ç›¸å…³çš„JavaScriptä»£ç 
        const BACKEND_URL = 'http://localhost:5000/api/chat';

        async function callBackendAPI(message) {
            try {
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Error calling backend:', error);
                // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œä½¿ç”¨å¤‡é€‰å“åº”
                return herbResponses[message] || 
                    `æŠ±æ­‰ï¼Œæˆ‘æš‚æ—¶æ— æ³•è®¿é—®å®Œæ•´çš„è¯æä¿¡æ¯ã€‚ä¸è¿‡æˆ‘çŸ¥é“${message}æ˜¯ä¸€å‘³é‡è¦çš„ä¸­è¯æ...`;
            }
        }

        // å‘é€æ¶ˆæ¯å‡½æ•°
        // æ–°ä»£ç 
        async function sendMessage() {
                const input = document.getElementById('userInput');
                const message = input.value.trim();
                const loading = document.getElementById('loading');
                
                // é‡ç½®loadingçš„æ˜¾ç¤ºçŠ¶æ€
                loading.style.display = 'none';
                
                if (message) {
                    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
                    addMessage(message, 'user');
                    input.value = '';

                    // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
                    loading.style.display = 'flex';

                    try {
                        // å‘é€è¯·æ±‚åˆ°åç«¯
                        const response = await fetch('http://localhost:5000/api/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ message })
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        // åˆ›å»ºä¸€ä¸ªæ–°çš„æ¶ˆæ¯divç”¨äºç´¯ç§¯å“åº”å†…å®¹
                        const messageDiv = document.createElement('div');
                        messageDiv.className = 'message assistant-message';
                        document.getElementById('chatMessages').appendChild(messageDiv);

                        // è®¾ç½®å“åº”æµè¯»å–
                        const reader = response.body.getReader();
                        const decoder = new TextDecoder();
                        let fullText = '';

                        while (true) {
                            const { value, done } = await reader.read();
                            if (done) {
                                // å®Œæˆæ—¶éšè—åŠ è½½åŠ¨ç”»
                                loading.style.display = 'none';
                                break;
                            }

                            const chunk = decoder.decode(value);
                            const lines = chunk.split('\n');
                            
                            for (const line of lines) {
                                if (line.startsWith('data: ')) {
                                    try {
                                        const data = JSON.parse(line.slice(6));
                                        if (data.error) {
                                            console.error('Error:', data.error);
                                            messageDiv.textContent = 'æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„è¯·æ±‚æ—¶å‡ºç°é”™è¯¯ã€‚';
                                            loading.style.display = 'none';
                                        } else if (data.content) {
                                            if (data.replace) {
                                                fullText = data.content;
                                            } else {
                                                fullText += data.content;
                                            }
                                            messageDiv.innerHTML = fullText.split('\n').map(line => 
                                                line.trim() ? `<p>${line}</p>` : '<br>'
                                            ).join('');
                                            messageDiv.scrollIntoView({ behavior: 'smooth' });
                                            loading.style.display = 'none';
                                        }
                                    } catch (e) {
                                        console.error('Parse error:', e);
                                        loading.style.display = 'none';
                                    }
                                }
                            }
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        loading.style.display = 'none';
                        addMessage('æŠ±æ­‰ï¼Œæˆ‘ç°åœ¨æ— æ³•å›ç­”æ‚¨çš„é—®é¢˜ã€‚è¯·ç¨åå†è¯•ã€‚', 'assistant');
                    }
                }
            else {
                // éšè—åŠ è½½åŠ¨ç”»
                document.getElementById('loading').style.display = 'none';
            }
        }
        // æ›´æ–°chat-inputç›‘å¬å™¨
        document.getElementById('userInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function addMessage(text, type) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.textContent = text;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        // Handle Enter key in chat input
        document.getElementById('userInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // è¯é£ŸåŒæºéƒ¨åˆ†çš„èœè°±åŠŸèƒ½
        const recipeData = {
            "å½“å½’ç‚–é¸¡": {
                effect: "å½“å½’ç‚–é¸¡å…·æœ‰è¡¥è¡€è°ƒç»çš„åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/ys1.png",
                steps: [
                    "å°†å½“å½’æ´—å‡€å¤‡ç”¨",
                    "é¸¡åˆ‡å—ï¼Œç„¯æ°´å»è¡€æ²«",
                    "å°†å½“å½’å’Œé¸¡å—ä¸€åŒç‚–ç…®2å°æ—¶"
                ]
            },
            "é»„èŠªç‚–ç¾Šè‚‰": {
                effect: "é»„èŠªç‚–ç¾Šè‚‰å…·æœ‰æ¸©é˜³è¡¥æ°”çš„åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/ys2.png",
                steps: [
                    "å°†é»„èŠªæ´—å‡€å¤‡ç”¨",
                    "ç¾Šè‚‰åˆ‡å—ï¼Œç„¯æ°´å»è¡€æ²«",
                    "å°†é»„èŠªå’Œç¾Šè‚‰å—ä¸€åŒç‚–ç…®2å°æ—¶"
                ]
            },
            "æ¸æçº¢æ£èŒ¶": {
                effect: "æ¸æçº¢æ£èŒ¶å…·æœ‰æ»‹è¡¥è‚è‚¾ã€ç›Šç²¾æ˜ç›®çš„åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/ys3.png",
                steps: [
                    "å°†æ¸æå’Œçº¢æ£æ´—å‡€",
                    "åŠ å…¥é€‚é‡æ°´ç…®æ²¸åå°ç«ç…®10åˆ†é’Ÿ",
                    "å¯åŠ å…¥é€‚é‡å†°ç³–è°ƒå‘³"
                ]
            },
            "å±±è¯ç‚’æœ¨è€³": {
                effect: "å±±è¯ç‚’æœ¨è€³å…·æœ‰å¥è„¾ç›Šè‚ºã€è¡¥è‚¾æ¶©ç²¾çš„åŠŸæ•ˆã€‚",
                image: "/static/images/herbs/ys4.png",
                steps: [
                    "å±±è¯åˆ‡ç‰‡ï¼Œæœ¨è€³æ³¡å‘",
                    "å°†å±±è¯å’Œæœ¨è€³ä¸€åŒç‚’è‡³ç†Ÿé€",
                    "åŠ å…¥é€‚é‡ç›å’Œè°ƒå‘³æ–™"
                ]
            }
        };

        document.getElementById('recipeSelect')?.addEventListener('change', function(e) {
            const selectedRecipe = e.target.value;
            const recipeDetails = document.getElementById('recipeDetails');
            
            if (selectedRecipe && recipeData[selectedRecipe]) {
                const recipe = recipeData[selectedRecipe];
                document.getElementById('recipeName').textContent = selectedRecipe;
                document.getElementById('recipeImage').src = recipe.image
                document.getElementById('recipeEffect').textContent = recipe.effect;
                document.getElementById('recipeImage').style.width = '60%';
                document.getElementById('recipeImage').style.height = 'auto';
                const stepsList = document.getElementById('recipeSteps');
                stepsList.innerHTML = '';
                recipe.steps.forEach(step => {
                    const li = document.createElement('li');
                    li.textContent = step;
                    stepsList.appendChild(li);
                });
                
                recipeDetails.style.display = 'block';
            } else {
                recipeDetails.style.display = 'none';
            }
        }
    
    );
    </script>
</body>
</html>